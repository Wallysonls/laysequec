<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Calculadora de Lay Sequencial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #111827; /* bg-gray-900 */
      }
      .panel {
        background-color: #1f2937; /* bg-gray-800 */
        border: 1px solid #374151; /* border-gray-700 */
      }
      .input-field {
        background-color: #374151; /* bg-gray-700 */
        border: 1px solid #4b5563; /* border-gray-600 */
      }
      .input-field:focus {
        outline: none;
        border-color: #38bdf8; /* border-sky-400 */
        box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.3);
      }
      .btn {
        transition: background-color 0.2s, transform 0.1s;
      }
      .btn-primary {
        background-color: #0ea5e9; /* bg-sky-500 */
        color: white;
      }
      .btn-primary:hover {
        background-color: #38bdf8; /* bg-sky-400 */
      }
      .btn-primary:active {
        transform: scale(0.98);
      }
      .btn-success {
        background-color: #22c55e; /* bg-green-500 */
        color: white;
      }
      .btn-success:hover {
        background-color: #4ade80; /* bg-green-400 */
      }
      .btn-danger {
        background-color: #ef4444; /* bg-red-500 */
        color: white;
      }
      .btn-danger:hover {
        background-color: #f87171; /* bg-red-400 */
      }
      .result-value {
        background-color: #111827;
        border: 1px dashed #4b5563;
      }
    </style>
</head>
<body class="text-gray-300">
  <div class="container mx-auto p-4 sm:p-6 max-w-2xl">
    <header class="text-center mb-8">
      <h1 class="text-3xl sm:text-4xl font-bold text-sky-400">
        Calculadora de Lay Sequencial
      </h1>
      <p class="text-gray-400 mt-2">Otimize suas promoções com segurança.</p>
    </header>

    <div id="setup-step" class="panel rounded-lg p-6 space-y-4">
      <h2 class="text-xl font-semibold text-white border-b border-gray-700 pb-2">
        Configuração da Múltipla
      </h2>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label for="backStake" class="block text-sm font-medium mb-1"
            >Valor da Aposta (R$)</label
          >
          <input
            type="number"
            id="backStake"
            class="input-field w-full rounded-md p-2"
            value="50"
          />
        </div>
        <div>
          <label for="backOdds" class="block text-sm font-medium mb-1"
            >Odd Total da Múltipla</label
          >
          <input
            type="number"
            id="backOdds"
            class="input-field w-full rounded-md p-2"
            value="4.90"
            step="0.01"
          />
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label for="selectionCount" class="block text-sm font-medium mb-1"
            >Número de Seleções</label
          >
          <select
            id="selectionCount"
            class="input-field w-full rounded-md p-2"
          >
            <option value="2">2</option>
            <option value="3" selected>3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>
        <div>
          <label for="commissionRate" class="block text-sm font-medium mb-1"
            >Comissão da Bolsa (%)</label
          >
          <input
            type="number"
            id="commissionRate"
            class="input-field w-full rounded-md p-2"
            value="4.5"
            step="0.1"
          />
        </div>
      </div>
      <div>
        <label for="calcMode" class="block text-sm font-medium mb-1"
          >Modo de Cálculo</label
        >
        <select id="calcMode" class="input-field w-full rounded-md p-2">
          <option value="standard" selected>Lucro Equilibrado (Standard)</option>
          <option value="lockin">Travar Lucro Final (Lock-in)</option>
          <option value="freebet">Usando Freebet</option>
        </select>
      </div>
      <button
        id="startBtn"
        class="btn btn-primary w-full font-bold py-3 mt-4 rounded-md"
      >
        Iniciar Cálculo Sequencial
      </button>
    </div>

    <div id="leg-step" class="panel rounded-lg p-6 space-y-4 hidden">
      <h2
        id="leg-title"
        class="text-xl font-semibold text-white border-b border-gray-700 pb-2"
      ></h2>

      <div>
        <label for="layOdds" class="block text-sm font-medium mb-1"
          >Odd Lay do Jogo Atual</label
        >
        <input
          type="number"
          id="layOdds"
          class="input-field w-full rounded-md p-2"
          placeholder="Ex: 1.65"
          step="0.01"
        />
      </div>

      <div id="leg-results" class="space-y-3 pt-2 hidden">
        <div>
          <p class="text-sm text-gray-400">Ação Recomendada:</p>
          <p id="lay-stake-action" class="text-lg font-semibold text-sky-400"></p>
        </div>
        <div>
          <p class="text-sm text-gray-400">Sua Responsabilidade será de:</p>
          <p id="lay-liability" class="text-lg font-semibold text-white"></p>
        </div>
        <div class="result-value p-3 rounded-md text-center">
          <p class="text-sm text-gray-400">Resultado Final Garantido:</p>
          <p id="qualifying-loss" class="text-2xl font-bold"></p>
        </div>
      </div>

      <div id="leg-outcome" class="pt-4 space-y-2 hidden">
        <p class="text-center font-semibold">
          A sua seleção do Jogo <span class="current-leg-number"></span> ganhou?
        </p>
        <div class="flex gap-4">
          <button
            id="leg-win-btn"
            class="btn btn-success w-full py-2 rounded-md font-bold"
          >
            SIM, GANHOU
          </button>
          <button
            id="leg-lose-btn"
            class="btn btn-danger w-full py-2 rounded-md font-bold"
          >
            NÃO, PERDEU / EMPATOU
          </button>
        </div>
      </div>
    </div>

    <div
      id="result-step"
      class="panel rounded-lg p-6 space-y-4 hidden text-center"
    >
      <h2 id="final-title" class="text-2xl font-bold"></h2>
      <p id="final-message" class="text-lg"></p>
      <button
        id="reset-btn"
        class="btn btn-primary w-full font-bold py-3 mt-4 rounded-md"
      >
        Calcular Nova Múltipla
      </button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const setupStep = document.getElementById('setup-step');
      const legStep = document.getElementById('leg-step');
      const resultStep = document.getElementById('result-step');

      const startBtn = document.getElementById('startBtn');
      const legWinBtn = document.getElementById('leg-win-btn');
      const legLoseBtn = document.getElementById('leg-lose-btn');
      const resetBtn = document.getElementById('reset-btn');

      const backStakeInput = document.getElementById('backStake');
      const backOddsInput = document.getElementById('backOdds');
      const selectionCountSelect = document.getElementById('selectionCount');
      const commissionRateInput = document.getElementById('commissionRate');
      const layOddsInput = document.getElementById('layOdds');
      const modeSelect = document.getElementById('calcMode');

      const legTitle = document.getElementById('leg-title');
      const legResults = document.getElementById('leg-results');
      const legOutcome = document.getElementById('leg-outcome');
      const layStakeAction = document.getElementById('lay-stake-action');
      const layLiability = document.getElementById('lay-liability');
      const qualifyingLoss = document.getElementById('qualifying-loss');
      const finalTitle = document.getElementById('final-title');
      const finalMessage = document.getElementById('final-message');

      let state = {};

      function calcularLay(
        mode,
        backStake,
        backOdds,
        layOdds,
        commission,
        accLiability,
        potentialReturn
      ) {
        if (layOdds <= 1 || isNaN(layOdds)) return null;

        let layStake = 0;
        let liability = 0;
        let resultadoFinal = 0;

        switch (mode) {
          case 'standard':
            // Lay stake para garantir lucro equilibrado considerando comissão corretamente:
            layStake = (potentialReturn - accLiability) / (layOdds - 1);
            liability = layStake * (layOdds - 1);
            const lucroLay = layStake * (1 - commission);
            resultadoFinal = lucroLay - (backStake + accLiability);
            break;

          case 'lockin':
            const lucroBack = (backOdds - 1) * backStake;
            // Lay stake para travar lucro final, considerando comissão no lucro do lay:
            layStake = (backStake + accLiability + lucroBack) / (layOdds - 1);
            liability = layStake * (layOdds - 1);
            resultadoFinal = lucroBack - liability - accLiability;
            break;

          case 'freebet':
            const lucroPotencial = backStake * (backOdds - 1);
            layStake = lucroPotencial / (layOdds - 1);
            liability = layStake * (layOdds - 1);
            resultadoFinal = layStake * (1 - commission) - accLiability;
            break;

          default:
            return null;
        }

        return {
          layStake: Number(layStake.toFixed(2)),
          liability: Number(liability.toFixed(2)),
          resultadoFinal: Number(resultadoFinal.toFixed(2)),
        };
      }

      function calculateLeg() {
        const layOdds = parseFloat(layOddsInput.value);
        const mode = modeSelect.value;

        const result = calcularLay(
          mode,
          state.backStake,
          state.backOdds,
          layOdds,
          state.commissionRate,
          state.accumulatedLiability,
          state.potentialReturn
        );

        if (!result) {
          legResults.classList.add('hidden');
          legOutcome.classList.add('hidden');
          return;
        }

        const { layStake, liability, resultadoFinal } = result;
        state.qualifyingLoss = resultadoFinal;

        layStakeAction.textContent = `Faça uma Aposta Lay de R$ ${layStake.toFixed(2)}`;
        layLiability.textContent = `R$ ${liability.toFixed(2)}`;

        qualifyingLoss.classList.remove('text-green-400', 'text-red-400');
        if (resultadoFinal >= 0) {
          qualifyingLoss.classList.add('text-green-400');
          qualifyingLoss.textContent = `+R$ ${resultadoFinal.toFixed(2)}`;
        } else {
          qualifyingLoss.classList.add('text-red-400');
          qualifyingLoss.textContent = `-R$ ${Math.abs(resultadoFinal).toFixed(2)}`;
        }

        legResults.classList.remove('hidden');
        legOutcome.classList.remove('hidden');
      }

      function initialize() {
        state = {
          backStake: 0,
          backOdds: 0,
          selectionCount: 0,
          commissionRate: 0,
          currentLeg: 1,
          accumulatedLiability: 0,
          qualifyingLoss: 0,
          potentialReturn: 0,
          mode: 'standard',
        };
        setupStep.classList.remove('hidden');
        legStep.classList.add('hidden');
        resultStep.classList.add('hidden');
        legResults.classList.add('hidden');
        legOutcome.classList.add('hidden');
        layOddsInput.value = '';
      }

      function startCalculation() {
        state.backStake = parseFloat(backStakeInput.value);
        state.backOdds = parseFloat(backOddsInput.value);
        state.selectionCount = parseInt(selectionCountSelect.value);
        state.commissionRate = parseFloat(commissionRateInput.value) / 100;
        state.potentialReturn = state.backStake * state.backOdds;
        state.mode = modeSelect.value;

        if (
          isNaN(state.backStake) ||
          isNaN(state.backOdds) ||
          state.backStake <= 0 ||
          state.backOdds <= 1
        ) {
          alert('Por favor, insira valores válidos para a aposta e as odds.');
          return;
        }

        setupStep.classList.add('hidden');
        legStep.classList.remove('hidden');
        updateLegUI();
      }

      function updateLegUI() {
        legTitle.textContent = `Cálculo da Perna ${state.currentLeg} de ${state.selectionCount}`;
        document
          .querySelectorAll('.current-leg-number')
          .forEach((el) => (el.textContent = state.currentLeg));
        layOddsInput.value = '';
        layOddsInput.focus();
      }

      function handleLegWin() {
        const layOdds = parseFloat(layOddsInput.value);
        const layStakeText = layStakeAction.textContent.match(/[\d\.-]+/);
        if (!layStakeText) return;
        const layStake = parseFloat(layStakeText[0]);

        state.accumulatedLiability += layStake * (layOdds - 1);
        state.currentLeg++;

        if (state.currentLeg > state.selectionCount) {
          const finalProfit =
            state.backStake * state.backOdds -
            state.backStake -
            state.accumulatedLiability;
          showFinalResult(
            `Parabéns! Sua múltipla foi vitoriosa.`,
            `Seu lucro final na operação foi de R$ ${finalProfit.toFixed(2)}.`
          );
        } else {
          legResults.classList.add('hidden');
          legOutcome.classList.add('hidden');
          updateLegUI();
        }
      }

      function handleLegLose() {
        showFinalResult(
          `Operação Concluída!`,
          `O resultado final da sua operação foi de R$ ${state.qualifyingLoss.toFixed(
            2
          )}, como planejado.`
        );
      }

      function showFinalResult(title, message) {
        finalTitle.textContent = title;
        finalMessage.textContent = message;
        legStep.classList.add('hidden');
        resultStep.classList.remove('hidden');
      }

      startBtn.addEventListener('click', startCalculation);
      layOddsInput.addEventListener('input', calculateLeg);
      legWinBtn.addEventListener('click', handleLegWin);
      legLoseBtn.addEventListener('click', handleLegLose);
      resetBtn.addEventListener('click', initialize);

      initialize();
    });
  </script>
</body>
</html>
