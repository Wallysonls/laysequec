<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Lay Sequencial Profissional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
        .panel { background-color: #1f2937; border: 1px solid #374151; }
        .input-field { background-color: #374151; border: 1px solid #4b5563; }
        .input-field:focus { outline: none; border-color: #38bdf8; box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.3); }
        .btn-primary { background-color: #0ea5e9; color: white; transition: background-color 0.2s, transform 0.1s; }
        .btn-primary:hover { background-color: #38bdf8; }
        .btn-primary:active { transform: scale(0.98); }
        .btn-success { background-color: #22c55e; color: white; }
        .btn-danger { background-color: #ef4444; color: white; }
    </style>
</head>
<body class="text-gray-300">

    <div class="container mx-auto p-4 sm:p-6 max-w-2xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-sky-400">Calculadora de Lay Sequencial</h1>
            <p class="text-gray-400 mt-2">Versão com Lógica de Equalização Precisa</p>
        </header>

        <div id="setup-step" class="panel rounded-lg p-6 space-y-4">
            <h2 class="text-xl font-semibold text-white border-b border-gray-700 pb-2">Configuração da Múltipla</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="backStake" class="block text-sm font-medium mb-1">Valor da Aposta (R$)</label>
                    <input type="number" id="backStake" class="input-field w-full rounded-md p-2" value="50">
                </div>
                <div>
                    <label for="commissionRate" class="block text-sm font-medium mb-1">Comissão da Bolsa (%)</label>
                    <input type="number" id="commissionRate" class="input-field w-full rounded-md p-2" value="6.5" step="0.1">
                </div>
            </div>
             <div id="legs-container" class="space-y-3">
                </div>
            <button id="add-leg-btn" class="btn-primary w-full py-2 rounded-md mt-2">Adicionar Perna</button>
            <button id="startBtn" class="btn-primary w-full font-bold py-3 mt-4 rounded-md">Iniciar Cálculo Sequencial</button>
        </div>

        <div id="leg-step" class="panel rounded-lg p-6 space-y-4 hidden">
            <h2 id="leg-title" class="text-xl font-semibold text-white border-b border-gray-700 pb-2"></h2>
            <div>
                <label for="layOdds" class="block text-sm font-medium mb-1">Odd Lay da Seleção Atual</label>
                <input type="number" id="layOdds" class="input-field w-full rounded-md p-2" placeholder="Ex: 1.85" step="0.01">
            </div>
            <div id="leg-results" class="space-y-3 pt-2 hidden">
                <div>
                    <p class="text-sm text-gray-400">Ação Recomendada:</p>
                    <p id="lay-stake-action" class="text-lg font-semibold text-sky-400"></p>
                </div>
                <div>
                    <p class="text-sm text-gray-400">Sua Responsabilidade será de:</p>
                    <p id="lay-liability" class="text-lg font-semibold text-white"></p>
                </div>
                <div style="background-color: #111827; border: 1px dashed #4b5563;" class="p-3 rounded-md text-center">
                    <p class="text-sm text-gray-400">Resultado Final Garantido:</p>
                    <p id="qualifying-loss" class="text-2xl font-bold"></p>
                </div>
            </div>
            <div id="leg-outcome" class="pt-4 space-y-2 hidden">
                <p class="text-center font-semibold">A sua seleção do Jogo <span class="current-leg-number"></span> ganhou?</p>
                <div class="flex gap-4">
                    <button id="leg-win-btn" class="btn-success w-full py-2 rounded-md font-bold">SIM, GANHOU</button>
                    <button id="leg-lose-btn" class="btn-danger w-full py-2 rounded-md font-bold">NÃO, PERDEU / EMPATOU</button>
                </div>
            </div>
        </div>

        <div id="result-step" class="panel rounded-lg p-6 space-y-4 hidden text-center">
             <h2 id="final-title" class="text-2xl font-bold"></h2>
             <p id="final-message" class="text-lg"></p>
             <button id="reset-btn" class="btn-primary w-full font-bold py-3 mt-4 rounded-md">Recomeçar</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const setupStep = document.getElementById('setup-step');
            const legStep = document.getElementById('leg-step');
            const resultStep = document.getElementById('result-step');
            const startBtn = document.getElementById('startBtn');
            const addLegBtn = document.getElementById('add-leg-btn');
            const legWinBtn = document.getElementById('leg-win-btn');
            const legLoseBtn = document.getElementById('leg-lose-btn');
            const resetBtn = document.getElementById('reset-btn');
            const backStakeInput = document.getElementById('backStake');
            const commissionRateInput = document.getElementById('commissionRate');
            const legsContainer = document.getElementById('legs-container');
            const layOddsInput = document.getElementById('layOdds');
            const legTitle = document.getElementById('leg-title');
            const legResults = document.getElementById('leg-results');
            const legOutcome = document.getElementById('leg-outcome');
            const layStakeAction = document.getElementById('lay-stake-action');
            const layLiability = document.getElementById('lay-liability');
            const qualifyingLoss = document.getElementById('qualifying-loss');
            const finalTitle = document.getElementById('final-title');
            const finalMessage = document.getElementById('final-message');
            
            let state = {};
            let legCounter = 0;

            function addLeg() {
                legCounter++;
                const legDiv = document.createElement('div');
                legDiv.innerHTML = `<label class="block text-sm font-medium mb-1">Odd Back da Perna ${legCounter}</label><input type="number" class="leg-back-odds input-field w-full rounded-md p-2" step="0.01">`;
                legsContainer.appendChild(legDiv);
            }

            function initialize() {
                state = {
                    backStake: 0,
                    commission: 0,
                    legs: [],
                    currentLegIndex: 0,
                    accumulatedLayLiability: 0,
                    totalBackOdds: 1
                };
                legCounter = 0;
                legsContainer.innerHTML = '';
                addLeg();
                addLeg();
                setupStep.classList.remove('hidden');
                legStep.classList.add('hidden');
                resultStep.classList.add('hidden');
            }

            function startCalculation() {
                state.backStake = parseFloat(backStakeInput.value);
                state.commission = parseFloat(commissionRateInput.value) / 100;
                const legOddsInputs = document.querySelectorAll('.leg-back-odds');
                state.legs = Array.from(legOddsInputs).map(input => parseFloat(input.value)).filter(val => !isNaN(val) && val > 1);

                if (state.legs.length < 2 || isNaN(state.backStake) || state.backStake <= 0) {
                    alert("Por favor, preencha pelo menos duas pernas com odds válidas e um valor de aposta.");
                    return;
                }
                
                state.totalBackOdds = state.legs.reduce((acc, odd) => acc * odd, 1);

                setupStep.classList.add('hidden');
                legStep.classList.remove('hidden');
                updateLegUI();
            }

            function updateLegUI() {
                const legNumber = state.currentLegIndex + 1;
                legTitle.textContent = `Cálculo da Perna ${legNumber} de ${state.legs.length}`;
                document.querySelectorAll('.current-leg-number').forEach(el => el.textContent = legNumber);
                layOddsInput.value = '';
                legResults.classList.add('hidden');
                legOutcome.classList.add('hidden');
                layOddsInput.focus();
            }

            function calculateLeg() {
                const layOdds = parseFloat(layOddsInput.value);
                if (isNaN(layOdds) || layOdds <= 1) {
                    legResults.classList.add('hidden');
                    legOutcome.classList.add('hidden');
                    return;
                }
                
                // --- LÓGICA PROFISSIONAL E CORRETA ---
                let backReturnIfWin = state.backStake * state.totalBackOdds;
                let layStake = (backReturnIfWin - state.accumulatedLayLiability) / (layOdds - state.commission);
                let liability = layStake * (layOdds - 1);
                let profitIfLayWins = layStake * (1 - state.commission);
                let finalResult = profitIfLayWins - state.backStake - state.accumulatedLayLiability;

                state.lastCalculatedResult = finalResult;

                layStakeAction.textContent = `Faça uma Aposta Lay de R$ ${layStake.toFixed(2)}`;
                layLiability.textContent = `R$ ${liability.toFixed(2)}`;
                qualifyingLoss.textContent = `R$ ${finalResult.toFixed(2)}`;
                qualifyingLoss.className = `text-2xl font-bold ${finalResult >= 0 ? 'text-green-400' : 'text-red-400'}`;

                legResults.classList.remove('hidden');
                legOutcome.classList.remove('hidden');
            }

            function handleLegWin() {
                const layOdds = parseFloat(layOddsInput.value);
                const layStakeText = layStakeAction.textContent.match(/[\d\.-]+/);
                if (!layStakeText) return;
                const layStake = parseFloat(layStakeText[0]);

                state.accumulatedLayLiability += layStake * (layOdds - 1);
                // Atualiza a odd total para as pernas restantes
                state.totalBackOdds /= state.legs[state.currentLegIndex];
                state.currentLegIndex++;

                if (state.currentLegIndex >= state.legs.length) {
                    const finalProfit = (state.backStake * state.legs.reduce((a, b) => a * b, 1)) - state.backStake - state.accumulatedLayLiability;
                    showFinalResult(`Parabéns! Sua múltipla foi vitoriosa.`, `Seu resultado final foi de R$ ${finalProfit.toFixed(2)}.`);
                } else {
                    updateLegUI();
                }
            }

            function handleLegLose() {
                showFinalResult(`Operação Concluída!`, `O resultado final da sua operação foi de R$ ${state.lastCalculatedResult.toFixed(2)}, como planejado.`);
            }

            function showFinalResult(title, message) {
                finalTitle.textContent = title;
                finalMessage.textContent = message;
                legStep.classList.add('hidden');
                resultStep.classList.remove('hidden');
            }

            addLegBtn.addEventListener('click', addLeg);
            startBtn.addEventListener('click', startCalculation);
            layOddsInput.addEventListener('input', calculateLeg);
            legWinBtn.addEventListener('click', handleLegWin);
            legLoseBtn.addEventListener('click', handleLegLose);
            resetBtn.addEventListener('click', initialize);

            initialize();
        });
    </script>
</body>
</html>
